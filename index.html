<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>FlowersForUkraine.com - Donate to the Flowers, Stop the War</title>
    <link rel="apple-touch-icon" sizes="180x180" href="./favicons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="./favicons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="./favicons/favicon-16x16.png">
    <link rel="stylesheet" type="text/css" href="//fonts.googleapis.com/css?family=Open+Sans"/>
    <link rel="stylesheet" href="./style.css">
    <script src="https://www.paypal.com/sdk/js?client-id=AQT2CU0VD8w2QDhq83Wt5WVRVb6t3Sn1QNu91XMqkM05kW0y981sb3ixt2chaocG-iCt-UjvhaTt-Lwe&currency=EUR&components=buttons&disable-funding=credit,card""></script>
</head>
<body>

<header class="header">
    <h1 class="site-name">FlowersForUkraine.com</h1>

    <h2 class="donation-request">
        Donate to the Flowers,<br/>
        Stop the War
    </h2>

    <h3 class="donation-goal">
        All the earned money<br/>
        are donated to Ukraine
    </h3>
</header>

<form action="/form_handler.php" method="post" class="form">

    <div class="property amount">
        <span class="label">Amount:</span>

        <label class="radio-option">
            <input type="radio" name="amount" value="30" required checked>
            <span class="main-content">30€</span>
        </label>

        <label class="radio-option">
            <input type="radio" name="amount" value="50">
            <span class="main-content">50€</span>
        </label>

        <label class="radio-option">
            <input type="radio" name="amount" value="70">
            <span class="main-content">70€</span>
        </label>
    </div>

    <div class="property pay-by">
        <span class="label">Pay by:</span>

        <label class="radio-option">
            <input type="radio" name="pay_by" value="stripe" required checked>
            <span class="main-content">Credit card (Stripe)</span>
        </label>

        <label class="radio-option">
            <input type="radio" name="pay_by" value="paypal">
            <span class="main-content">PayPal</span>
        </label>
    </div>

    <div class="property deliver-to">
        <span class="label">Deliver to:</span>

        <div class="radio-option">
            <input type="radio" name="deliver_to" id="deliver-to-1" value="refugee_shelter" required checked>
            <label class="main-content" for="deliver-to-1">Refugee Shelter</label>
            <span class="sub-content">
                We deliver your flowers directly to Ukrainians, who had to leave the counry. To help them see the light.
            </span>
        </div>

        <div class="radio-option">
            <input type="radio" name="deliver_to" id="deliver-to-2" value="shop">
            <label class="main-content" for="deliver-to-2">Shop and Pick Up</label>
            <span class="sub-content">
                After payment you should pick it up by yourself in the shop:<br/>
                <a href="https://g.page/Sisustuspood?share" target="_blank" class="address">Kukupesa sisustuskaubamaja, Pärnu maantee, Tallinn, Estonia</a><br/>
                Monday–Saturday, 10AM–6PM
            </span>
        </div>
    </div>

    <div class="property email">
        <label class="label" for="email">Email:</label>
        <input type="email" name="email" id="email" required>

        <button id="donate" class="donate-btn">Donate</button>

        <div id="paypal-buttons-container" class="paypal-buttons-container"></div>
    </div>
</form>


<footer class="footer">
    <div class="section">Contact us for more information:</div>
    <div class="section">

        <a class="phone-number-wrapper" href="#" data-code="+372" data-number="51991891"
            onclick="window.location.href = 'tel:' + this.dataset.code + this.dataset.number; return false;">
            <img class="icon" src="./whatsapp-logo.png" alt="[WhatsUp]">
            <div class="phone-number cryptedphone" data-code="+372" data-number="5199 18 91"></div>
        </a>

        <a class="phone-number-wrapper" href="https://instagram.com/arrowstone_flowers?utm_medium=copy_link">
            <img class="icon" src="./insta-logo.png" alt="[Instagram]">
            <div class="phone-number">arrowstone_flowers</div>
        </a>

        <a class="phone-number-wrapper last" href="#" data-name="arrowstone.flowers" data-domain="gmail" data-tld="com"
        onclick="window.location.href = 'mailto:' + this.dataset.name + '@' + this.dataset.domain + '.' + this.dataset.tld; return false;">
            <img class="icon" src="./email-logo.png" alt="[WhatsUp Icon]">
            <div class="phone-number cryptedmail" data-name="arrowstone.flowers" data-domain="gmail" data-tld="com"></div>
        </a>
    </div>
</footer>

</body>
</html>


<script>
    // Render the PayPal buttons
    paypal.Buttons({
        style: {
            layout:  'vertical',
            color:   'blue',
            shape:   'pill',
            label:   'paypal'
        },
        createOrder: function(data, actions) {
          let amount = document.querySelector('input[name="amount"]:checked').value;
          let email = document.querySelector('input[name="email"]').value;

          let refugeeShelterAddress =  {
            type: 'SHIPPING',
            address: 'Refugee Shelter'
          };
          let pickUpAddress = {
            type: 'PICKUP_IN_PERSON',
            address: 'Kukupesa sisustuskaubamaja, Pärnu maantee, Tallinn, Estonia'
          };

          // TODO need to fill shipping address corectly. here is a schema https://developer.paypal.com/api/orders/v2/#definition-shipping_detail
          // shipping property for purchase_units object
          let shipping = document.querySelector('input[name="deliver_to"]:checked').value === 'shop' ? pickUpAddress : refugeeShelterAddress;

          return actions.order.create({
            payer: {
                email: email
            },
            purchase_units: [{
              amount: {
                "currency_code": "EUR",
                value: amount
              }
            }]
          },
          );
        }, // Finalize the transaction after payer approval
        onApprove: function(data, actions) {
          return actions.order.capture().then(function(orderData) {
           // DISPLAY SUCCESS MESSAGE/SCREEN
           console.log('Capture result', orderData, JSON.stringify(orderData, null, 2));
          });
        }
    }).render('#paypal-buttons-container');
    document.body.querySelector('#paypal-buttons-container').style.display = 'none';

    document.querySelectorAll('input[name=pay_by]').forEach(function (el) {
      el.addEventListener('change', function (event) {
          if(event.target.value === "paypal") {
            document.body.querySelector('#paypal-buttons-container').style.display = 'block';

            document.body.querySelector('#donate').style.display = 'none';
          } else {
            document.body.querySelector('#donate').style.display = 'block';

            document.body.querySelector('#paypal-buttons-container').style.display = 'none';
          }
      });
    });
</script>